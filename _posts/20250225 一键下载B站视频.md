# “一键下载 B 站高清有声视频”终极指南
这是一个为你整理的完整操作指南，涵盖了从**环境搭建**到**最终下载**的所有步骤。你可以直接复制下面的 Markdown 内容保存为 `.md` 文件。

***

# 🎬 B 站高清视频下载终极指南 (为 AI 视频重绘做准备)

本指南旨在帮助你从零开始，在 Windows PC 上配置环境，完美下载 B 站高清（1080P+/4K）、有声、无水印的视频文件，作为后续 AI 视频编辑（如 ComfyUI 局部重绘或火山引擎 Seedance 重绘）的高质量源素材。

---

## 📋 核心工具清单
在开始之前，我们需要准备三个核心组件：
1.  **yt-dlp**: GitHub 高星项目，强大的视频下载核心。
2.  **ffmpeg**: 音视频处理神器，用于合并分离的音画轨道（解决无声问题）。
3.  **Cookies 插件**: 用于获取登录状态，绕过 B 站反爬机制（解决 412 报错）。

---

## 🛠️ 第一步：下载并配置 `yt-dlp`

`yt-dlp` 是一个单文件程序，无需安装，但需要配置环境变量以便在任何目录使用。

### 1. 下载程序
1.  访问 GitHub 发布页：[https://github.com/yt-dlp/yt-dlp/releases](https://github.com/yt-dlp/yt-dlp/releases)
2.  在最新版本的 "Assets" 列表中，找到并下载 **`yt-dlp.exe`**。
    *   *注意：不要下载源码包，直接下载 `.exe` 可执行文件。*

### 2. 创建专用目录
1.  在电脑中创建一个文件夹，例如：`C:\tools\yt-dlp`。
2.  将下载的 `yt-dlp.exe` 移动到此文件夹中。

### 3. 配置环境变量 (让命令行随处可用)
1.  按 `Win + S`，搜索 **`env`**，选择 **"Edit the system environment variables"** (编辑系统环境变量)。
2.  点击右下角的 **"Environment Variables..."** 按钮。
3.  在下方 **"System variables"** (系统变量) 区域，找到 **`Path`**，选中后点击 **"Edit..."**。
4.  点击 **"New"**，输入你的文件夹路径：`C:\tools\yt-dlp`。
5.  连续点击 **"OK"** 保存所有窗口。

### 4. 验证安装
1.  按 `Win + R`，输入 `cmd` 回车，打开命令提示符。
2.  输入以下命令：
    ```bash
    yt-dlp --version
    ```
3.  如果显示版本号（如 `2026.02.25`），则配置成功。

---

## 🛠️ 第二步：下载并配置 `ffmpeg` (解决无声问题)

B 站高清视频采用“音画分离”技术，必须依靠 `ffmpeg` 合并，否则下载的视频将没有声音。

### 1. 下载程序
1.  访问 ffmpeg 构建网站：[https://www.gyan.dev/ffmpeg/builds/](https://www.gyan.dev/ffmpeg/builds/)
2.  找到 **"ffmpeg-release-essentials.zip"** (绿色高亮)，点击下载。

### 2. 解压与整理
1.  解压下载的 zip 包。
2.  将解压后的文件夹重命名为 `ffmpeg`。
3.  将其移动到永久目录，例如：`C:\tools\ffmpeg`。
    *   确认路径结构为：`C:\tools\ffmpeg\bin\ffmpeg.exe`。

### 3. 配置环境变量
1.  再次打开 **"Edit the system environment variables"** (参考第一步)。
2.  进入 **"Environment Variables"** -> 选中 **`Path`** -> 点击 **"Edit..."**。
3.  点击 **"New"**，输入 `bin` 目录的路径：`C:\tools\ffmpeg\bin`。
    *   *关键点：必须包含 `\bin`，因为 exe 文件在里面。*
4.  连续点击 **"OK"** 保存。

### 4. 验证安装
1.  **关闭当前所有 CMD 窗口**，重新打开一个新的 CMD (必须重启才能生效)。
2.  输入：
    ```bash
    ffmpeg -version
    ```
3.  如果显示版本信息，说明配置成功。

---

## 🛠️ 第三步：获取 B 站登录 Cookies (解决 412 报错)

B 站会拦截未登录的爬虫请求 (HTTP 412 Error)，且自动读取浏览器 Cookies 常因权限问题失败。**手动导出 Cookies 是最稳定方案。**

### 1. 安装浏览器插件
1.  打开 Chrome 浏览器，访问 Chrome 应用商店。
2.  搜索并安装 **"Get cookies.txt LOCALLY"**。
3.  安装完成后，点击右上角拼图图标 🧩，将该插件**固定**到工具栏。

### 2. 登录并导出
1.  打开 [bilibili.com](https://www.bilibili.com)，**登录你的账号** (若是大会员视频，务必登录大会员号)。
2.  点击浏览器右上角的插件图标 📄⬇️。
3.  在弹出窗口中点击 **"Export"** 按钮。
4.  浏览器会自动下载一个名为 `cookies.txt` 的文件 (通常在“下载”文件夹)。
    *   *建议：将此文件移动到 `C:\tools\yt-dlp` 目录下，方便管理。*

---

## 🚀 第四步：执行下载命令

现在所有环境已就绪，开始下载高清有声视频。

### 1. 准备命令
打开 CMD，进入你的工具目录 (可选，方便管理文件)：
```bash
cd C:\tools\yt-dlp
```

### 2. 运行下载
复制以下命令，**替换其中的 Cookies 路径和视频链接**：

```bash
yt-dlp --cookies "cookies.txt" -f "bestvideo+bestaudio/best" --merge-output-format mp4 -o "%(title)s.mp4" "https://www.bilibili.com/video/你的视频ID"
```

**💡 操作小技巧：**
*   **Cookies 路径**：如果 `cookies.txt` 在当前目录，直接写文件名即可；如果在其他位置，可以输入 `--cookies ` (注意空格) 后，直接把 `cookies.txt` 文件**拖入**CMD 窗口，它会自动填入绝对路径。
*   **视频链接**：替换为你想要下载的 B 站视频 URL。

### 3. 参数详解
| 参数 | 作用 |
| :--- | :--- |
| `--cookies "..."` | 注入登录身份，解锁高清画质，绕过 412 反爬拦截。 |
| `-f "bestvideo+bestaudio..."` | 强制下载最高清的视频流和最高质的音频流。 |
| `--merge-output-format mp4` | 调用 `ffmpeg` 将音画合并为标准 MP4 格式。 |
| `-o "%(title)s.mp4"` | 以视频标题命名文件，避免文件名乱码。 |

### 4. 观察日志
成功的下载过程应包含以下关键日志：
1.  `[download] Destination: ...f1.mp4` (下载视频流)
2.  `[download] Destination: ...m4a` (下载音频流)
3.  **`[Merger] Merging into...`** 或 **`[ffmpeg] Merging formats...`** (关键：正在合并声音)
4.  `[ExtractAudio] Not extracting audio as requested.` (结束)

---

## ✅ 第五步：验证与后续使用

1.  **检查文件**：在下载目录找到生成的 MP4 文件。
2.  **播放测试**：用播放器打开，确认**画面清晰** (1080P/4K) 且**声音同步**。
3.  **投入使用**：
    *   **方案 A (云端 AI)**：上传至 [即梦 (Dreamina)](https://dreamina.jianying.com/) 或火山引擎，使用“视频生视频”功能，输入提示词（如“把武器换成鸭脖”）进行重绘。
    *   **方案 B (本地 AI)**：导入 ComfyUI，配合 AnimateDiff + ControlNet + SAM 工作流进行局部重绘。

---

## 🆘 常见问题速查 (Troubleshooting)

| 错误现象 | 可能原因 | 解决方案 |
| :--- | :--- | :--- |
| **HTTP Error 412** | 未携带 Cookies 或 Cookies 过期 | 重新登录 B 站，重新导出 `cookies.txt`，确保命令中路径正确。 |
| **视频没声音** | 未安装 `ffmpeg` 或环境变量未生效 | 检查 `ffmpeg -version` 是否可用；**务必重启 CMD** 后再试。 |
| **画质只有 480P** | 未登录账号 | 确保使用的是已登录大会员账号导出的 Cookies。 |
| **DPAPI 解密失败** | 尝试自动读取浏览器 Cookies 失败 | **放弃自动读取**，坚持使用本指南的**手动导出插件法**。 |
| **Chrome 进程占用** | 浏览器未完全关闭导致无法读取 | 手动导出法不需要关闭浏览器，无视此错误。 |

---

> **🎉 恭喜！** 你现在已经拥有了完美的视频源文件，可以开始你的 AI 视频创作之旅了！